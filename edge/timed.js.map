{"version":3,"sources":["timed.js"],"names":["timed","addTimed","node","opts","id","name","val","soul","data","console","log","logging","args","cb","nextObj","nextOpts","stopCondition","operation","interval","num","maxNum","defaultStop","defaultNextObj","defaultNextOpts","defaultOp","obj","put","setTimeout","error","chain"],"mappings":"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","file":"timed.js","sourcesContent":["import Gun from 'gun/gun';\n\nexport function timed(node, opts = {}) {\n  let id, name\n  node.val(data => {\n    id = Gun.node.soul(data)\n    name = opts.name || id || 'unknown'\n  })\n\n  console.log('TIMED', opts)\n\n  const log = function (...args) {\n    if (opts.log || opts.logging) {\n      console.log('timed:', name, ...args)\n    }\n  }\n\n  if (typeof opts === 'function') {\n    opts = {\n      cb: opts\n    }\n  }\n\n  let {\n    cb,\n    nextObj,\n    nextOpts,\n    stopCondition,\n    operation,\n    logging,\n    interval = 100,\n    num = 0,\n    maxNum = 10\n  } = opts\n\n  log('timed', opts)\n\n  let defaultStop = ({\n    num\n  }, opts) => {\n    return num > maxNum\n  }\n  let defaultNextObj = (num, opts) => {\n    return {\n      num: num + 1\n    }\n  }\n\n  let defaultNextOpts = (opts, num) => {\n    return Object.assign(opts, {\n      num\n    })\n  }\n\n  let defaultOp = (node, obj, opts) => {\n    log('put', obj)\n    node.put(obj)\n  }\n\n  nextObj = nextObj || defaultNextObj\n  nextOpts = nextOpts || defaultNextOpts\n  stopCondition = stopCondition || defaultStop\n  operation = operation || defaultOp\n\n  setTimeout(() => {\n    let obj = Object.assign(nextObj(num, opts))\n    operation(node, obj, opts)\n    if (stopCondition(obj, opts)) {\n      if (cb) {\n        cb(num)\n      } else {\n        console.error('timed: Missing cb to stop', opts)\n        // process.exit(1)\n      }\n    }\n\n    timed(node, nextOpts(opts, obj.num))\n  }, interval)\n}\n\nexport function addTimed({\n  chain\n}) {\n  chain.timed = function (opts) {\n    return timed(this, opts)\n  }\n  return chain\n}"]}